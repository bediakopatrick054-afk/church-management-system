{% extends "base.html" %}

{% block page_title %}Visitor Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="stat-card">
            <h3>Track and manage church visitors</h3>
            <div class="row" style="margin-top: 20px;">
                <div class="col-6">
                    <input type="text" class="form-control" placeholder="Search visitors by name, email, or phone...">
                </div>
                <div class="col-3">
                    <button class="btn btn-primary" style="width: 100%;" onclick="showRegisterVisitor()">
                        <i class="fas fa-user-plus"></i> Register New Visitor
                    </button>
                </div>
                <div class="col-3">
                    <button class="btn btn-success" style="width: 100%;" onclick="showConverted()">
                        <i class="fas fa-users"></i> Converted to Members
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th></th>
                <th>Name</th>
                <th>Contact</th>
                <th>First Visit</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for visitor in visitors %}
            <tr>
                <td>
                    <div style="width: 40px; height: 40px; background: #2a7f4b; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        {{ visitor.full_name[:2]|upper }}
                    </div>
                </td>
                <td>
                    <strong>{{ visitor.full_name }}</strong><br>
                    <small>Heard from: {{ visitor.heard_from }}</small>
                </td>
                <td>
                    {{ visitor.phone }}<br>
                    <small>{{ visitor.email }}</small>
                </td>
                <td>{{ visitor.first_visit_date }}<br><small>{{ visitor.first_visit_date|days_ago }} days ago</small></td>
                <td>
                    <span class="badge badge-warning">{{ visitor.status }}</span>
                </td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="viewVisitor('{{ visitor.visitor_id }}')">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-success" onclick="convertVisitor('{{ visitor.visitor_id }}')">
                        <i class="fas fa-user-check"></i>
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div style="margin-top: 20px; color: #666;">
        Showing 1 to {{ visitors|length }} of {{ visitors|length }} visitors
    </div>
</div>

<!-- Register Visitor Modal -->
<div id="registerVisitorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
    <div style="background: white; width: 500px; margin: 100px auto; padding: 30px; border-radius: 10px;">
        <h3 style="margin-bottom: 20px;">Register New Visitor</h3>
        
        <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-control" id="visitor_name" required>
        </div>
        
        <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="text" class="form-control" id="visitor_phone" required>
        </div>
        
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" id="visitor_email">
        </div>
        
        <div class="form-group">
            <label class="form-label">How did they hear about us?</label>
            <select class="form-control" id="visitor_heard">
                <option>Website</option>
                <option>Friend</option>
                <option>Social Media</option>
                <option>Radio</option>
                <option>Billboard</option>
                <option>Other</option>
            </select>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="hideRegisterVisitor()">Cancel</button>
            <button class="btn btn-success" onclick="saveVisitor()">Register Visitor</button>
        </div>
    </div>
</div>

<script>
    function showRegisterVisitor() {
        document.getElementById('registerVisitorModal').style.display = 'block';
    }
    
    function hideRegisterVisitor() {
        document.getElementById('registerVisitorModal').style.display = 'none';
    }
    
    function showConverted() {
        alert('Converted members list coming soon!');
    }
    
    function viewVisitor(id) {
        alert('Viewing visitor: ' + id);
    }
    
    function convertVisitor(id) {
        if(confirm('Convert this visitor to a church member?')) {
            alert('Visitor converted to member successfully!');
        }
    }
    
    function saveVisitor() {
        alert('Visitor registered successfully!');
        hideRegisterVisitor();
    }
</script>
{% endblock %}